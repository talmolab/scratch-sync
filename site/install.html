<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Installation - scratch-sync</title>
  <meta name="description" content="How to install scratch-sync on macOS, Linux, and Windows.">
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>
  <nav>
    <a href="/">Home</a>
    <a href="/install.html">Installation</a>
    <a href="/cli.html">CLI Reference</a>
    <a href="https://github.com/talmolab/scratch-sync">GitHub</a>
  </nav>

  <h1>Installation</h1>
  <p class="tagline">Get scratch-sync running on your machines</p>

  <h2>Prerequisites</h2>

  <p>Before installing scratch-sync, make sure you have:</p>

  <ul>
    <li><strong><a href="https://tailscale.com/download">Tailscale</a></strong> installed and connected on all machines you want to sync</li>
    <li>All machines on the <strong>same Tailnet</strong></li>
  </ul>

  <h2>Quick Install</h2>

  <div class="tabs">
    <button class="tab active" onclick="showTab('unix')">macOS / Linux</button>
    <button class="tab" onclick="showTab('windows')">Windows</button>
  </div>

  <div id="unix" class="tab-content active">
    <div class="code-block">
      <pre><code>curl -LsSf https://scratch.tlab.sh/install.sh | sh</code></pre>
      <button class="copy-btn" onclick="copyCode(this, 'curl -LsSf https://scratch.tlab.sh/install.sh | sh')">Copy</button>
    </div>
  </div>

  <div id="windows" class="tab-content">
    <div class="code-block">
      <pre><code>iwr -useb https://scratch.tlab.sh/install.ps1 | iex</code></pre>
      <button class="copy-btn" onclick="copyCode(this, 'iwr -useb https://scratch.tlab.sh/install.ps1 | iex')">Copy</button>
    </div>
  </div>

  <h2>What the Installer Does</h2>

  <h3>macOS / Linux</h3>

  <p>The install script performs these steps:</p>

  <ol>
    <li><strong>Detects your platform</strong> (macOS or Linux, Intel or ARM)</li>
    <li><strong>Downloads Syncthing</strong> from the official GitHub releases</li>
    <li><strong>Installs the binary</strong> to <code>~/.local/bin/syncthing</code></li>
    <li><strong>Sets up auto-start:</strong>
      <ul>
        <li>macOS: Creates a LaunchAgent at <code>~/Library/LaunchAgents/com.syncthing.syncthing.plist</code></li>
        <li>Linux: Creates a systemd user service at <code>~/.config/systemd/user/syncthing.service</code></li>
      </ul>
    </li>
    <li><strong>Starts Syncthing</strong> in the background</li>
    <li><strong>Shows dependency status</strong> for uv, Tailscale, and Syncthing</li>
    <li><strong>Reminds you to set up dashboard credentials</strong></li>
  </ol>

  <h3>Dependency Status</h3>

  <p>After installation, you'll see a summary of all dependencies:</p>

  <div class="code-block">
    <pre><code>Dependencies

  uv           installed 0.9.18     ~/.local/bin/uv
  tailscale    running   1.92.3     your-tailnet.org / you@example.com
  syncthing    running v2.0.12    ~/.local/bin/syncthing / autostart: launchd</code></pre>
  </div>

  <p>Check status anytime with:</p>

  <div class="code-block">
    <pre><code>curl -LsSf https://scratch.tlab.sh/install.sh | sh -s -- --status</code></pre>
    <button class="copy-btn" onclick="copyCode(this, 'curl -LsSf https://scratch.tlab.sh/install.sh | sh -s -- --status')">Copy</button>
  </div>

  <h3>Windows</h3>

  <p>The PowerShell installer:</p>

  <ol>
    <li><strong>Detects your architecture</strong> (x64, ARM64, or x86)</li>
    <li><strong>Downloads Syncthing</strong> from the official GitHub releases</li>
    <li><strong>Installs the binary</strong> to <code>%LOCALAPPDATA%\Programs\syncthing</code></li>
    <li><strong>Creates a Scheduled Task</strong> to run Syncthing at login</li>
    <li><strong>Optionally adds to PATH</strong> (you'll be prompted)</li>
    <li><strong>Starts Syncthing</strong> immediately</li>
  </ol>

  <h2>Installation Options</h2>

  <h3>macOS / Linux Options</h3>

  <table>
    <tr>
      <th>Option</th>
      <th>Description</th>
    </tr>
    <tr>
      <td><code>--status</code></td>
      <td>Show dependency status (uv, Tailscale, Syncthing) without installing</td>
    </tr>
    <tr>
      <td><code>--uninstall</code></td>
      <td>Remove Syncthing and the auto-start service</td>
    </tr>
    <tr>
      <td><code>--upgrade</code></td>
      <td>Upgrade to the latest Syncthing version</td>
    </tr>
    <tr>
      <td><code>-y, --yes</code></td>
      <td>Skip confirmation prompts (for scripting)</td>
    </tr>
  </table>

  <p>Environment variables:</p>

  <table>
    <tr>
      <th>Variable</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
    <tr>
      <td><code>INSTALL_DIR</code></td>
      <td><code>~/.local/bin</code></td>
      <td>Where to install the binary</td>
    </tr>
    <tr>
      <td><code>NO_SERVICE</code></td>
      <td><code>0</code></td>
      <td>Set to 1 to skip service setup</td>
    </tr>
    <tr>
      <td><code>SYNCTHING_VERSION</code></td>
      <td>Latest</td>
      <td>Specific version to install</td>
    </tr>
  </table>

  <p>Examples:</p>

  <div class="code-block">
    <pre><code># Check dependency status
curl -LsSf https://scratch.tlab.sh/install.sh | sh -s -- --status

# Uninstall
curl -LsSf https://scratch.tlab.sh/install.sh | sh -s -- --uninstall

# Upgrade to latest
curl -LsSf https://scratch.tlab.sh/install.sh | sh -s -- --upgrade

# Install without prompts
curl -LsSf https://scratch.tlab.sh/install.sh | sh -s -- -y

# Custom install directory
INSTALL_DIR=/opt/bin curl -LsSf https://scratch.tlab.sh/install.sh | sh</code></pre>
  </div>

  <h3>Windows Options</h3>

  <p>When running the script directly (after downloading):</p>

  <table>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
    <tr>
      <td><code>-Status</code></td>
      <td>Show dependency status (uv, Tailscale, Syncthing) without installing</td>
    </tr>
    <tr>
      <td><code>-Uninstall</code></td>
      <td>Remove Syncthing and scheduled task</td>
    </tr>
    <tr>
      <td><code>-AllUsers</code></td>
      <td>Install as Windows service (requires admin)</td>
    </tr>
  </table>

  <p>Environment variables (for remote execution with <code>iwr | iex</code>):</p>

  <table>
    <tr>
      <th>Variable</th>
      <th>Description</th>
    </tr>
    <tr>
      <td><code>STATUS=1</code></td>
      <td>Show dependency status without installing</td>
    </tr>
    <tr>
      <td><code>UNINSTALL=1</code></td>
      <td>Remove Syncthing and scheduled task</td>
    </tr>
    <tr>
      <td><code>ALLUSERS=1</code></td>
      <td>Install as Windows service (requires admin)</td>
    </tr>
  </table>

  <p>Examples:</p>

  <div class="code-block">
    <pre><code># Check status (remote)
$env:STATUS=1; iwr -useb https://scratch.tlab.sh/install.ps1 | iex

# Uninstall (remote)
$env:UNINSTALL=1; iwr -useb https://scratch.tlab.sh/install.ps1 | iex

# Install for all users (remote, requires admin)
$env:ALLUSERS=1; iwr -useb https://scratch.tlab.sh/install.ps1 | iex

# Download and run with parameters
Invoke-WebRequest -Uri https://scratch.tlab.sh/install.ps1 -OutFile install.ps1
.\install.ps1 -Status
.\install.ps1 -Uninstall
.\install.ps1 -AllUsers</code></pre>
  </div>

  <h2>Installing the CLI</h2>

  <p>The scratch-sync CLI is a Python package that helps you manage synced folders. Choose your preferred installation method:</p>

  <h3>Permanent Install (Recommended)</h3>

  <p>Install globally so you can run <code>scratch-sync</code> from anywhere:</p>

  <div class="code-block">
    <pre><code>uv tool install scratch-sync</code></pre>
    <button class="copy-btn" onclick="copyCode(this, 'uv tool install scratch-sync')">Copy</button>
  </div>

  <p>This creates an isolated environment for scratch-sync and adds the executable to your PATH.</p>

  <h3>Run Without Installing</h3>

  <p>If you prefer not to install permanently, use <code>uvx</code> to run the latest version on-demand:</p>

  <div class="code-block">
    <pre><code>uvx scratch-sync --help</code></pre>
    <button class="copy-btn" onclick="copyCode(this, 'uvx scratch-sync --help')">Copy</button>
  </div>

  <div class="note">
    <p><strong>Note:</strong> <code>uvx</code> is an alias for <code>uv tool run</code>. It runs commands in a temporary environment without permanent installation.</p>
  </div>

  <h3>Update &amp; Uninstall</h3>

  <p>Update to the latest version:</p>

  <div class="code-block">
    <pre><code>uv tool upgrade scratch-sync</code></pre>
  </div>

  <p>Uninstall:</p>

  <div class="code-block">
    <pre><code>uv tool uninstall scratch-sync</code></pre>
  </div>

  <p>List installed tools:</p>

  <div class="code-block">
    <pre><code>uv tool list</code></pre>
  </div>

  <h2>Verifying Installation</h2>

  <p>After installation, verify everything is working:</p>

  <div class="code-block">
    <pre><code>syncthing --version</code></pre>
  </div>

  <p>Open the web UI to verify it's running:</p>

  <ul>
    <li>macOS: <code>open http://127.0.0.1:8384</code></li>
    <li>Linux: <code>xdg-open http://127.0.0.1:8384</code></li>
    <li>Windows: <code>start http://127.0.0.1:8384</code></li>
  </ul>

  <p>Get your device ID:</p>

  <div class="code-block">
    <pre><code>syncthing cli show system | grep myID</code></pre>
  </div>

  <h2>Dashboard Setup</h2>

  <div class="note" style="border-left: 4px solid #f59e0b; background: #fefce8; padding: 1rem;">
    <p><strong>Important:</strong> After installation, set up a password for the Syncthing dashboard to secure your instance.</p>
  </div>

  <p>The Syncthing dashboard is accessible at <a href="http://127.0.0.1:8384/">http://127.0.0.1:8384/</a></p>

  <p>On first visit:</p>
  <ol>
    <li>Go to <strong>Actions &gt; Settings &gt; GUI</strong></li>
    <li>Set a <strong>username and password</strong></li>
    <li>Click <strong>Save</strong></li>
  </ol>

  <p>This protects your Syncthing instance if the dashboard is exposed on a network interface.</p>

  <h2>Troubleshooting</h2>

  <h3>Syncthing not in PATH</h3>

  <p>If <code>syncthing</code> command is not found, add the install directory to your PATH:</p>

  <div class="code-block">
    <pre><code># Add to ~/.bashrc or ~/.zshrc
export PATH="$HOME/.local/bin:$PATH"</code></pre>
  </div>

  <h3>Service not starting (Linux)</h3>

  <div class="code-block">
    <pre><code># Check service status
systemctl --user status syncthing

# View logs
journalctl --user -u syncthing -f

# Manually start
systemctl --user start syncthing</code></pre>
  </div>

  <h3>Service not starting (macOS)</h3>

  <div class="code-block">
    <pre><code># Check if loaded
launchctl list | grep syncthing

# View logs
tail -f ~/Library/Logs/syncthing.log

# Manually load
launchctl load ~/Library/LaunchAgents/com.syncthing.syncthing.plist</code></pre>
  </div>

  <footer>
    <a href="https://github.com/talmolab/scratch-sync">GitHub</a>
    <a href="/">Home</a>
    <a href="/cli.html">CLI Reference</a>
    <a href="https://pypi.org/project/scratch-sync/">PyPI</a>
  </footer>

  <script>
    function showTab(id) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.querySelector(`[onclick="showTab('${id}')"]`).classList.add('active');
      document.getElementById(id).classList.add('active');
    }

    function copyCode(btn, text) {
      navigator.clipboard.writeText(text).then(() => {
        btn.textContent = 'Copied!';
        btn.classList.add('copied');
        setTimeout(() => {
          btn.textContent = 'Copy';
          btn.classList.remove('copied');
        }, 2000);
      });
    }

    // Auto-detect OS and select appropriate tab
    (function() {
      const platform = navigator.platform.toLowerCase();
      const userAgent = navigator.userAgent.toLowerCase();
      if (platform.includes('win') || userAgent.includes('windows')) {
        showTab('windows');
      }
      // macOS and Linux default to 'unix' tab (already active)
    })();
  </script>
</body>
</html>
